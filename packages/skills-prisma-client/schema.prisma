generator client {
  provider = "prisma-client-js"
}

generator externalClient {
  provider      = "prisma-client-js"
  output        = "../packages/skills-prisma-client"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Event {
  id          String       @id @default(uuid())
  topic       String       @db.VarChar(255)
  payload     Json
  payloadHash String?      @map("payload_hash")
  createdAt   DateTime     @default(now()) @map("created_at")
  skillEvents SkillEvent[]

  @@unique([payloadHash], map: "uniq_payload_hash")
  @@map("event")
}

model SkillCategory {
  id          String   @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  skills      Skill[]

  @@unique([name], map: "uniq_category_name")
  @@map("skill_category")
}

model Skill {
  id             String                 @id @default(uuid())
  name           String
  description    String?
  categoryId     String?                @map("category_id")
  createdAt      DateTime               @default(now()) @map("created_at")
  updatedAt      DateTime               @updatedAt @map("updated_at")
  deletedAt      DateTime?              @map("deleted_at")
  name_embedding Unsupported("vector")?

  category    SkillCategory? @relation(fields: [categoryId], references: [id])
  skillEvents SkillEvent[]
  userSkills  UserSkill[]

  @@unique([name], map: "uniq_skill_name")
  @@index([categoryId], map: "fki_fk_skill_category")
  @@map("skill")
}

model SkillEventType {
  id          String       @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  skillEvents SkillEvent[]

  @@unique([name], map: "uniq_event_type_name")
  @@map("skill_event_type")
}

model SourceType {
  id          String       @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  skillEvents SkillEvent[]

  @@unique([name], map: "uniq_source_type_name")
  @@map("source_type")
}

model SkillEvent {
  id               String   @id @default(uuid())
  eventId          String   @map("event_id")
  userId           Int      @map("user_id")
  skillId          String   @map("skill_id")
  skillEventTypeId String   @map("skill_event_type_id")
  sourceId         String   @map("source_id") @db.Text
  sourceTypeId     String   @map("source_type_id")
  createdAt        DateTime @default(now()) @map("created_at")

  event          Event          @relation(fields: [eventId], references: [id])
  skill          Skill          @relation(fields: [skillId], references: [id])
  skillEventType SkillEventType @relation(fields: [skillEventTypeId], references: [id])
  sourceType     SourceType     @relation(fields: [sourceTypeId], references: [id])

  @@unique([skillId, sourceId, skillEventTypeId, userId], map: "uniq_skill_source_id")
  @@index([eventId], map: "fki_fk_event")
  @@index([skillEventTypeId], map: "fki_fk_skill_event_type")
  @@index([sourceTypeId], map: "fki_fk_source_type")
  @@map("skill_event")
}

model UserSkillLevel {
  id          String      @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  userSkills  UserSkill[]

  @@unique([name], map: "uniq_skill_level_name")
  @@map("user_skill_level")
}

model UserSkillDisplayMode {
  id          String      @id
  name        String
  description String?
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  userSkills  UserSkill[]

  @@unique([name], map: "user_skill_display_mode_name_key")
  @@map("user_skill_display_mode")
}

model UserSkill {
  id                     String   @id @default(uuid())
  userId                 Int      @map("user_id")
  skillId                String   @map("skill_id")
  userSkillLevelId       String   @map("user_skill_level_id")
  userSkillDisplayModeId String   @map("user_skill_display_mode_id")
  createdAt              DateTime @default(now()) @map("created_at")
  updatedAt              DateTime @updatedAt @map("updated_at")

  skill                Skill                @relation(fields: [skillId], references: [id])
  userSkillLevel       UserSkillLevel       @relation(fields: [userSkillLevelId], references: [id])
  userSkillDisplayMode UserSkillDisplayMode @relation(fields: [userSkillDisplayModeId], references: [id])

  @@unique([userId, skillId, userSkillLevelId], map: "uniq_user_skill_type")
  @@index([skillId], map: "fki_fk_skill")
  @@index([userSkillLevelId], map: "fki_fk_user_skill_level")
  @@index([userSkillDisplayModeId], map: "fki_fk_user_skill_display_mode")
  @@map("user_skill")
}

model WorkSkill {
  id         String   @id @default(uuid())
  workId     String   @map("work_id")
  workTypeId String   @map("work_type_id")
  skillId    String   @map("skill_id")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@unique([workId, workTypeId, skillId], map: "uniq_work_skill")
  @@map("work_skill")
}
