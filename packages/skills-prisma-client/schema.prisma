generator client {
  provider = "prisma-client-js"
}

generator externalClient {
  provider      = "prisma-client-js"
  output        = "../packages/skills-prisma-client"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("TC_SKILLS_DATABASE_URL")
}

model event {
  id           String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  topic        String        @db.VarChar(255)
  payload      Json
  payload_hash String?       @unique(map: "uniq_payload_hash")
  created_at   DateTime      @default(now())
  skill_event  skill_event[]
}

model skill {
  id             String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name           String                 @unique(map: "uniq_skill_name") @db.VarChar(100)
  description    String?
  category_id    String?                @db.Uuid
  created_at     DateTime               @default(now())
  updated_at     DateTime               @default(now())
  deleted_at     DateTime?
  name_embedding Unsupported("vector")?
  skill_category skill_category?        @relation(fields: [category_id], references: [id], onUpdate: NoAction, map: "fk_skill_category")
  skill_event    skill_event[]
  user_skill     user_skill[]

  @@index([category_id], map: "fki_fk_skill_category")
}

model skill_category {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String   @unique(map: "uniq_category_name") @db.VarChar(100)
  description String?
  created_at  DateTime @default(now())
  updated_at  DateTime @default(now())
  skill       skill[]
}

model skill_event {
  id                  String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  event_id            String           @db.Uuid
  user_id             Int
  skill_id            String           @db.Uuid
  skill_event_type_id String           @db.Uuid
  source_id           String
  source_type_id      String           @db.Uuid
  created_at          DateTime         @default(now())
  event               event            @relation(fields: [event_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_event")
  skill_event_type    skill_event_type @relation(fields: [skill_event_type_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_skill_event_type")
  skill               skill            @relation(fields: [skill_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_skill")
  source_type         source_type      @relation(fields: [source_type_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_source_type")

  @@unique([skill_id, source_id, skill_event_type_id, user_id], map: "uniq_skill_source_id")
  @@index([event_id], map: "fki_fk_event")
  @@index([skill_event_type_id], map: "fki_fk_skill_event_type")
  @@index([source_type_id], map: "fki_fk_source_type")
}

model skill_event_type {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String        @unique(map: "uniq_event_type_name") @db.VarChar(100)
  description String?
  created_at  DateTime      @default(now())
  updated_at  DateTime      @default(now())
  skill_event skill_event[]
}

model source_type {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String        @unique(map: "uniq_source_type_name") @db.VarChar(100)
  description String?
  created_at  DateTime      @default(now())
  updated_at  DateTime      @default(now())
  skill_event skill_event[]
}

model user_skill {
  id                         String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                    Int
  skill_id                   String                  @db.Uuid
  user_skill_level_id        String                  @db.Uuid
  created_at                 DateTime                @default(now())
  updated_at                 DateTime                @default(now())
  user_skill_display_mode_id String                  @default(dbgenerated("'1555aa05-a764-4f0b-b3e0-51b824382abb'::uuid")) @db.Uuid
  skill                      skill                   @relation(fields: [skill_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_skill")
  user_skill_display_mode    user_skill_display_mode @relation(fields: [user_skill_display_mode_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user_skill_level           user_skill_level        @relation(fields: [user_skill_level_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_user_skill_level")

  @@unique([user_id, skill_id, user_skill_level_id], map: "uniq_user_skill_type")
  @@index([skill_id], map: "fki_fk_skill")
  @@index([user_skill_level_id], map: "fki_fk_user_skill_level")
  @@index([user_skill_display_mode_id], map: "fki_fk_user_skill_display_mode")
}

model user_skill_display_mode {
  id          String       @id @db.Uuid
  name        String       @unique @db.VarChar(100)
  description String?
  created_at  DateTime     @default(now())
  updated_at  DateTime     @default(now())
  user_skill  user_skill[]
}

model user_skill_level {
  id          String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String       @unique(map: "uniq_skill_level_name") @db.VarChar(100)
  description String?
  created_at  DateTime     @default(now())
  updated_at  DateTime     @default(now())
  user_skill  user_skill[]
}

model work_skill {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  work_id      String   @db.Uuid
  work_type_id String   @db.Uuid
  skill_id     String   @db.Uuid
  created_at   DateTime @default(now())
  updated_at   DateTime @default(now())

  @@unique([work_id, work_type_id, skill_id], map: "uniq_work_skill")
}
